<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <title>dixzAPK - Comic Life</title>
    <meta name="theme-color" content="#ff85a2">
    
    <!-- PWA Settings -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="dixzAPK">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="dixzAPK">
    <meta name="msapplication-TileColor" content="#ff85a2">
    <meta name="msapplication-TileImage" content="https://i.supaimg.com/d303cdfa-9ede-4b8f-a7e8-331f9fa15dbb.jpg">

    <!-- Icons -->
    <link rel="apple-touch-icon" href="https://i.supaimg.com/d303cdfa-9ede-4b8f-a7e8-331f9fa15dbb.jpg">
    <link rel="apple-touch-icon" sizes="152x152" href="https://i.supaimg.com/d303cdfa-9ede-4b8f-a7e8-331f9fa15dbb.jpg">
    <link rel="apple-touch-icon" sizes="180x180" href="https://i.supaimg.com/d303cdfa-9ede-4b8f-a7e8-331f9fa15dbb.jpg">
    <link rel="icon" type="image/png" href="https://i.supaimg.com/d303cdfa-9ede-4b8f-a7e8-331f9fa15dbb.jpg">
    <link rel="shortcut icon" href="https://i.supaimg.com/d303cdfa-9ede-4b8f-a7e8-331f9fa15dbb.jpg">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&family=Patrick+Hand&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet" />

    <script>
        // Inline Manifest PWA
        const manifestData = {
            "name": "dixzAPK",
            "short_name": "dixzAPK",
            "description": "dixzAPK - Comic Life Application",
            "start_url": "./",
            "scope": "./",
            "display": "standalone",
            "orientation": "portrait",
            "background_color": "#f8f9fa",
            "theme_color": "#ff85a2",
            "icons": [
                { "src": "https://i.supaimg.com/d303cdfa-9ede-4b8f-a7e8-331f9fa15dbb.jpg", "sizes": "192x192", "type": "image/jpeg", "purpose": "any maskable" },
                { "src": "https://i.supaimg.com/d303cdfa-9ede-4b8f-a7e8-331f9fa15dbb.jpg", "sizes": "512x512", "type": "image/jpeg", "purpose": "any maskable" }
            ],
            "categories": ["lifestyle", "utilities"],
            "lang": "id",
            "dir": "ltr"
        };

        const manifestBlob = new Blob([JSON.stringify(manifestData)], { type: 'application/json' });
        const manifestURL = URL.createObjectURL(manifestBlob);
        const manifestLink = document.createElement('link');
        manifestLink.rel = 'manifest';
        manifestLink.href = manifestURL;
        document.head.appendChild(manifestLink);

        // Service Worker
        const swCode = `
            const CACHE_NAME = 'dixzAPK-vFinalFix';
            const urlsToCache = ['./', 'https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&family=Patrick+Hand&family=Poppins:wght@300;400;600&display=swap'];
            self.addEventListener('install', (event) => { event.waitUntil(caches.open(CACHE_NAME).then((cache) => cache.addAll(urlsToCache)).then(() => self.skipWaiting())); });
            self.addEventListener('activate', (event) => { event.waitUntil(caches.keys().then((cacheNames) => Promise.all(cacheNames.filter((name) => name !== CACHE_NAME).map((name) => caches.delete(name)))).then(() => self.clients.claim())); });
            self.addEventListener('fetch', (event) => { event.respondWith(caches.match(event.request).then((response) => response || fetch(event.request).catch(() => new Response('Offline')))); });
        `;

        if ('serviceWorker' in navigator) {
            const swBlob = new Blob([swCode], { type: 'application/javascript' });
            navigator.serviceWorker.register(URL.createObjectURL(swBlob), { scope: './' }).catch(console.error);
        }

        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => { e.preventDefault(); deferredPrompt = e; });
    </script>

    <style>
        :root {
            --primary-color: #ff85a2;
            --secondary-color: #70d6ff;
            --bg-color: #f8f9fa;
            --text-color: #333;
            --card-bg: #ffffff;
            --border-style: 3px solid #333;
            --grid-color: rgba(0, 0, 0, 0.08);
            --holiday-color: #ff4d4d;
        }

        body.dark-mode {
            --bg-color: #1a1a2e;
            --text-color: #e0e0e0;
            --card-bg: #16213e;
            --primary-color: #e94560;
            --border-style: 3px solid #e0e0e0;
            --grid-color: rgba(255, 255, 255, 0.05);
            --holiday-color: #ff6b6b;
        }

        /* --- PERBAIKAN SCROLLBAR THUMB (FORCED) --- */
        /* Kode ini memaksa browser seluler untuk merender scrollbar kustom */
        ::-webkit-scrollbar {
            -webkit-appearance: none; /* Penting untuk mobile */
            width: 10px;
            height: 10px;
            background-color: transparent;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05); 
            border-left: 1px solid var(--text-color);
        }

        ::-webkit-scrollbar-thumb {
            background-color: var(--primary-color);
            border: 2px solid var(--text-color);
            border-radius: 20px;
            min-height: 40px; /* Agar thumb tidak terlalu kecil */
        }

        ::-webkit-scrollbar-thumb:hover {
            background-color: var(--secondary-color);
        }

        /* Class khusus untuk memaksa scroll container pada mobile */
        .fast-scroll-container {
            overflow-y: scroll; /* Menggunakan 'scroll' bukan 'auto' untuk memaksa tampilan */
            -webkit-overflow-scrolling: touch; /* Smooth scrolling di iOS */
            scrollbar-width: thin;
            scrollbar-color: var(--primary-color) rgba(0,0,0,0.05);
        }
        /* ------------------------------------------- */

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            overflow-x: hidden;
            padding-bottom: 120px;
            background-image: linear-gradient(var(--grid-color) 1px, transparent 1px), linear-gradient(90deg, var(--grid-color) 1px, transparent 1px);
            background-size: 25px 25px;
        }

        /* ICONS */
        .icon-comic { width: 24px; height: 24px; stroke: var(--text-color); stroke-width: 2.5; fill: none; stroke-linecap: round; stroke-linejoin: round; }
        .icon-header { width: 28px; height: 28px; margin-right: 8px; stroke: var(--primary-color); }

        /* SPLASH SCREEN (ANIMASI BARU) */
        #splash-screen { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: var(--bg-color); z-index: 9999; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            transition: opacity 0.8s ease-out, visibility 0.8s; 
            background-image: linear-gradient(var(--grid-color) 1px, transparent 1px), linear-gradient(90deg, var(--grid-color) 1px, transparent 1px); 
            background-size: 25px 25px; 
        }
        
        /* Animasi Bounce untuk Logo */
        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); opacity: 1; }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); }
        }
        
        .splash-content { text-align: center; }
        
        .splash-logo { 
            font-family: 'Comic Neue', cursive; font-size: 4rem; font-weight: bold; 
            color: var(--primary-color); -webkit-text-stroke: 2px var(--text-color); 
            text-shadow: 5px 5px 0px var(--text-color); margin-bottom: 20px;
            animation: bounceIn 1s cubic-bezier(0.215, 0.610, 0.355, 1.000) both;
        }
        
        .loading-bar { 
            width: 200px; height: 12px; border: 2px solid var(--text-color); 
            border-radius: 10px; background: white; overflow: hidden; margin: 0 auto; 
            position: relative;
        }
        
        /* Animasi Loading Shimmer */
        .loading-progress { 
            height: 100%; width: 0%; 
            background: repeating-linear-gradient(
                45deg,
                var(--primary-color),
                var(--primary-color) 10px,
                var(--secondary-color) 10px,
                var(--secondary-color) 20px
            );
            background-size: 200% 200%;
            transition: width 0.5s; 
            animation: shimmer 2s linear infinite;
        }
        @keyframes shimmer { 0% { background-position: 0% 50%; } 100% { background-position: 100% 50%; } }

        /* NAV */
        .top-nav { position: fixed; top: 0; width: 100%; height: 60px; background: var(--card-bg); border-bottom: var(--border-style); display: flex; justify-content: space-between; align-items: center; padding: 0 16px; z-index: 2000; }
        .logo { font-family: 'Comic Neue', cursive; font-weight: 700; font-size: 1.8rem; color: var(--primary-color); -webkit-text-stroke: 1px var(--text-color); }

        /* SIDEBAR */
        .sidebar { position: fixed; left: -320px; top: 0; width: 300px; height: 100vh; background: var(--card-bg); border-right: var(--border-style); z-index: 3000; padding: 20px; padding-bottom: 80px; overflow-y: auto; transition: left 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); display: flex; flex-direction: column; }
        .sidebar.active { left: 0; }
        .side-item { margin: 10px 0; padding: 12px; background: var(--bg-color); border: 2px solid var(--text-color); border-radius: 12px; cursor: pointer; font-weight: bold; display: flex; align-items: center; gap: 15px; }
        .logout-btn { margin-top: auto; background: #ff4d4d; color: white; text-align: center; justify-content: center; }

        /* CONTENT */
        .content { padding: 80px 16px 20px 16px; max-width: 600px; margin: 0 auto; min-height: 100vh; }
        .premium-card { background: var(--card-bg); border: var(--border-style); border-radius: 20px; padding: 20px; margin-bottom: 24px; box-shadow: 6px 6px 0px var(--text-color); position: relative; overflow: hidden; }
        h3 { display: flex; align-items: center; margin: 20px 0 10px 0; font-family: 'Comic Neue'; font-size: 1.3rem; }

        /* APP STYLES */
        #allAppsPage { padding: 80px 16px; min-height: 100vh; }
        #appSearchInput { width: 100%; margin-bottom: 20px; padding: 12px; font-family: 'Patrick Hand', sans-serif; font-size: 1.1rem; border: 3px solid var(--text-color); border-radius: 15px; box-shadow: 4px 4px 0 var(--text-color); outline: none; background: #fff; color: #333; }
        .app-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-top: 10px; }
        .app-item { display: flex; flex-direction: column; align-items: center; text-align: center; cursor: grab; user-select: none; position: relative; }
        .app-item.dragging { opacity: 0.5; transform: scale(1.1); z-index: 100; }
        .app-icon-box { width: 100%; aspect-ratio: 1; border: 2px solid var(--text-color); border-radius: 15px; overflow: hidden; background: #fff; margin-bottom: 5px; box-shadow: 3px 3px 0 var(--text-color); pointer-events: none; }
        .app-icon-box img { width: 100%; height: 100%; object-fit: cover; }
        .app-name { font-size: 0.75rem; font-weight: bold; line-height: 1.2; max-width: 100%; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; pointer-events: none; }

        /* APP VIEW */
        #appViewContainer { position: fixed; top: 60px; bottom: 70px; left: 0; width: 100%; background: var(--bg-color); z-index: 1500; display: none; flex-direction: column; }
        .app-view-header { height: 40px; background: var(--card-bg); border-bottom: var(--border-style); display: flex; align-items: center; padding: 0 16px; gap: 10px; }
        .app-back-btn { cursor: pointer; display: flex; align-items: center; gap: 5px; color: #ff4d4d; font-weight: bold; }
        .app-frame { flex: 1; border: none; width: 100%; height: 100%; }

        /* CALENDAR, SCHEDULE, BUTTONS */
        .calendar-controls { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .cal-btn { background: var(--bg-color); border: 2px solid var(--text-color); padding: 5px 10px; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .calendar-header { font-weight: bold; font-family: 'Comic Neue'; font-size: 1.1rem; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; }
        .cal-day-name { font-size: 0.8rem; text-align: center; font-weight: bold; color: var(--primary-color); }
        .cal-date { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; border: 1px solid #ccc; border-radius: 5px; font-family: 'Patrick Hand'; cursor: pointer; }
        .cal-date.today { background: var(--secondary-color); color: var(--text-color); border: 2px solid var(--text-color); font-weight: bold; }
        .cal-date.holiday { color: var(--holiday-color); font-weight: bold; border-color: var(--holiday-color); background: rgba(255, 77, 77, 0.1); }
        .holiday-desc { font-size: 0.9rem; color: var(--holiday-color); margin-top: 10px; font-weight: bold; text-align: center; min-height: 20px; padding: 5px; border-top: 1px dashed #ccc; font-style: italic; }
        .schedule-grid { display: grid; grid-template-columns: repeat(5, 1fr); border: 2px solid var(--text-color); border-radius: 10px; overflow: hidden; }
        .schedule-header { background: var(--primary-color); color: white; font-size: 0.7rem; text-align: center; padding: 5px; border-right: 1px solid var(--text-color); }
        .schedule-cell { background: var(--bg-color); padding: 5px; text-align: center; font-size: 0.7rem; border-right: 1px solid var(--text-color); border-top: 1px solid var(--text-color); min-height: 40px; display: flex; align-items: center; justify-content: center; font-family: 'Patrick Hand'; }
        .btn-comic { background: var(--primary-color); color: white; border: 2px solid var(--text-color); padding: 10px; border-radius: 10px; cursor: pointer; font-weight: bold; box-shadow: 3px 3px 0px var(--text-color); width: 100%; margin-top: 5px; text-transform: uppercase; }
        .btn-comic:active { transform: translate(2px, 2px); box-shadow: 1px 1px 0 var(--text-color); }
        input, textarea, select { width: 100%; padding: 10px; margin: 5px 0; border: 2px solid var(--text-color); border-radius: 10px; background: var(--bg-color); color: var(--text-color); font-family: 'Patrick Hand'; font-size: 1rem; }

        /* MUSIC & MEDIA */
        .music-header { display: flex; gap: 1%; align-items: center; margin-bottom: 10px; }
        #musicSearchInput { width: 65%; margin: 0; box-shadow: 3px 3px 0 var(--text-color); }
        .btn-album { width: 34%; margin: 0; padding: 11px 0; font-size: 0.8rem; background: var(--secondary-color); color: var(--text-color); border: 2px solid var(--text-color); border-radius: 10px; font-weight: bold; box-shadow: 3px 3px 0 var(--text-color); cursor: pointer; text-align: center; }
        .music-scroll-area { max-height: 280px; padding-right: 5px; } /* Combined with fast-scroll-container */
        .music-item { padding: 8px 12px; border: 2px solid var(--text-color); margin: 6px 0; border-radius: 12px; display: flex; justify-content: space-between; background: var(--bg-color); align-items: center; box-shadow: 3px 3px 0 rgba(0,0,0,0.1); transition: 0.1s; }
        .btn-play-stylish { width: 35px; height: 35px; border-radius: 50%; background: var(--primary-color); border: 2px solid var(--text-color); color: white; display: flex; align-items: center; justify-content: center; margin-right: 10px; cursor: pointer; font-size: 0.9rem; box-shadow: 2px 2px 0 var(--text-color); }
        .music-info-box { flex: 1; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; font-weight: bold; }
        .music-duration-text { font-size: 0.75rem; font-weight: bold; color: #666; margin-right: 10px; background: rgba(0,0,0,0.05); padding: 2px 6px; border-radius: 5px; }
        .btn-options { background: none; border: none; font-size: 1.2rem; font-weight: bold; color: var(--text-color); cursor: pointer; padding: 0 5px; transform: rotate(90deg); }
        .album-list-horizontal { display: flex; overflow-x: auto; gap: 10px; padding: 10px 0; white-space: nowrap; }
        .music-album-card { min-width: 120px; height: 120px; background: var(--card-bg); border: 2px solid var(--text-color); border-radius: 15px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; box-shadow: 3px 3px 0 var(--text-color); position: relative; }
        .create-album-card { border-style: dashed; background: rgba(0,0,0,0.05); }
        .profile-card-comic { text-align: center; padding: 25px; }
        .profile-img-comic { width: 100px; height: 100px; border-radius: 50%; border: 3px solid var(--text-color); object-fit: cover; background: #ddd; }
        .album-header-box { display: flex; align-items: center; overflow-x: auto; white-space: nowrap; padding: 10px; margin-bottom: 10px; border: 3px solid var(--text-color); border-radius: 15px; background: var(--bg-color); box-shadow: 3px 3px 0 var(--text-color); }
        .album-tab { display: inline-block; padding: 8px 15px; margin-right: 8px; border: 2px solid var(--text-color); border-radius: 10px; font-weight: bold; cursor: pointer; background: white; color: var(--text-color); transition: all 0.2s; user-select: none; }
        .album-tab.active { background: var(--primary-color); color: white; box-shadow: 2px 2px 0 var(--text-color); }
        .media-scroll-area { max-height: 550px; padding-right: 5px; } /* Combined with fast-scroll-container */
        .media-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .media-box { position: relative; aspect-ratio: 1; border: 3px solid var(--text-color); border-radius: 16px; overflow: hidden; background: #eee; cursor: pointer; box-shadow: 3px 3px 0 var(--text-color); }
        .media-box img, .media-box video { width: 100%; height: 100%; object-fit: cover; display: block; pointer-events: none; }
        
        .upload-options { display: flex; justify-content: space-around; gap: 10px; margin-top: 20px; }
        .upload-icon-btn { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; background: var(--bg-color); border: 2px solid var(--text-color); border-radius: 15px; padding: 15px; cursor: pointer; box-shadow: 4px 4px 0 var(--text-color); }
        .upload-svg { width: 40px; height: 40px; stroke: var(--text-color); margin-bottom: 5px; fill: none; stroke-width: 2; }
        
        .receipt-box { background: #fff; padding: 20px; border: 2px dashed #333; font-family: 'Courier New', monospace; text-align: center; position: relative; margin-top: 10px; }
        .wallet-growth { position: absolute; top: -15px; right: 0; background: #4ade80; color: #004d00; border: 2px solid var(--text-color); padding: 2px 8px; border-radius: 12px; font-weight: bold; font-size: 0.8rem; box-shadow: 2px 2px 0 rgba(0,0,0,0.2); }
        
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 2500; }
        .modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 400px; background: var(--card-bg); border: 3px solid var(--text-color); border-radius: 20px; padding: 20px; z-index: 3000; max-height: 85vh; overflow-y: hidden; /* use fast-scroll-container inside */ }
        
        #audioBar { position: fixed; bottom: 80px; left: 10px; right: 10px; background: var(--card-bg); border: 3px solid var(--text-color); border-radius: 25px; padding: 12px 20px; display: none; flex-direction: column; z-index: 900; box-shadow: 0 8px 0 rgba(0,0,0,0.2); animation: slideUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes slideUp { from { transform: translateY(100px); opacity:0; } to { transform: translateY(0); opacity:1; } }
        .audio-top { display: flex; align-items: center; justify-content: space-between; width: 100%; margin-bottom: 8px; }
        .audio-title { font-weight: bold; font-family: 'Comic Neue'; font-size: 1rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 75%; color: var(--primary-color); -webkit-text-stroke: 0.5px var(--text-color); }
        .audio-controls { display: flex; align-items: center; width: 100%; gap: 10px; font-size: 0.75rem; font-weight: bold; font-family: monospace; }
        .audio-slider { flex: 1; height: 8px; -webkit-appearance: none; background: #eee; border-radius: 5px; outline: none; border: 2px solid var(--text-color); overflow: hidden; }
        .audio-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 0; height: 0; box-shadow: -400px 0 0 400px var(--secondary-color); }
        .bar-play-btn { background: none; border: none; cursor: pointer; }
        .bar-play-btn svg { width: 30px; height: 30px; fill: var(--text-color); transition: 0.2s; }
        
        #previewOverlay { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); align-items: center; justify-content: center; flex-direction: column; }
        .preview-carousel { width: 100%; height: 85vh; display: flex; flex-direction: column; overflow-y: auto; overflow-x: hidden; scroll-snap-type: y mandatory; align-items: center; }
        .preview-item { flex: 0 0 100%; width: 100%; height: 100%; scroll-snap-align: center; display: flex; justify-content: center; align-items: center; position: relative; padding: 20px; }
        .preview-item img, .preview-item video { max-width: 100%; max-height: 100%; object-fit: contain; box-shadow: 0 10px 30px rgba(0,0,0,0.3); border-radius: 10px; }

        .bottom-nav { position: fixed; bottom: 0; width: 100%; height: 70px; background: var(--card-bg); border-top: var(--border-style); display: flex; justify-content: space-around; align-items: center; z-index: 1000; }
        .nav-item { opacity: 0.5; transition: 0.3s; text-align: center; flex: 1; }
        .nav-item.active-nav { opacity: 1; transform: translateY(-5px); }
        .hidden { display: none !important; }
    </style>
</head>
<!-- BODY MENGGUNAKAN FAST SCROLL CONTAINER -->
<body class="fast-scroll-container">

    <div id="splash-screen">
        <div class="splash-content">
            <div class="splash-logo">dixzAPK</div>
            <p style="font-family:'Patrick Hand'; font-size:1.5rem; margin-bottom:15px;">Menyiapkan Data...</p>
            <div class="loading-bar"><div class="loading-progress" id="splashProgress"></div></div>
        </div>
    </div>

    <div class="overlay" id="overlay" onclick="closeAll()"></div>

    <nav class="top-nav">
        <div class="logo">dixzAPK</div>
        <div onclick="toggleSidebar()" style="cursor: pointer;">
            <svg class="icon-comic" viewBox="0 0 24 24"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
        </div>
    </nav>

    <div class="sidebar" id="sidebar">
        <h2 style="font-family:'Comic Neue'; margin-bottom:15px; border-bottom:2px dashed var(--text-color);">Menu Aplikasi</h2>
        <div class="side-item" onclick="toggleDarkMode()"><svg class="icon-comic" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg><span>Tema Gelap/Terang</span></div>
        <div class="side-item" onclick="checkAuth('modalUang')"><svg class="icon-comic" viewBox="0 0 24 24"><path d="M12 1v22M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg><span>Input Tabungan</span></div>
        <div class="side-item" onclick="checkAuth('modalMapel')"><svg class="icon-comic" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg><span>Edit Jadwal</span></div>
        <div class="side-item" onclick="checkAuth('modalTarget')"><svg class="icon-comic" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12" y2="17"></line></svg><span>Tambah Misi</span></div>
        <div class="side-item" onclick="checkAuth('modalAlbum')"><svg class="icon-comic" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg><span>Upload Galeri</span></div>
        <div class="side-item" onclick="checkAuth('modalAddApp')"><svg class="icon-comic" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><path d="M12 8v8"></path><path d="M8 12h8"></path></svg><span>Tambahkan Apk</span></div>
        <div class="side-item" onclick="checkAuth('modalRenameAppSelection', loadRenameAppList)"><svg class="icon-comic" viewBox="0 0 24 24"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg><span>Ganti Nama Apk</span></div>
        <div class="side-item" onclick="checkAuth('modalDeleteApp', loadDeleteAppList)"><svg class="icon-comic" viewBox="0 0 24 24"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg><span>Hapus Apk</span></div>
        <div style="border-top: 2px dashed var(--text-color); margin: 10px 0;"></div>
        <div class="side-item" onclick="checkAuth(null, exportData)"><svg class="icon-comic" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg><span>Backup Data</span></div>
        <div class="side-item" onclick="showModal('modalImport')"><svg class="icon-comic" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg><span>Masukan Data</span></div>
        <div class="side-item logout-btn" onclick="doLogout()"><svg class="icon-comic" style="stroke:white;" viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg><span>KELUAR (LOG OUT)</span></div>
    </div>

    <!-- HOME PAGE -->
    <main class="content" id="homePage">
        <h2 id="welcomeText" style="font-family:'Comic Neue'; margin-bottom:10px;">Selamat Datang!</h2>
        <h3><svg class="icon-header" viewBox="0 0 24 24"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>SALDO SAYA</h3>
        <div class="premium-card">
            <div style="font-size: 2rem; font-weight: bold; font-family:'Comic Neue'; color:var(--primary-color); -webkit-text-stroke: 1px var(--text-color);">Rp <span id="displaySaldo">0</span></div>
            <div style="display: flex; gap: 10px; align-items: center; margin-top: 10px;">
                <button class="btn-comic" style="width:auto; font-size:0.8rem; margin:0; flex:1;" onclick="checkAuth('modalWalletDetail')">Riwayat</button>
                <div onclick="checkAuth('modalWithdraw')" style="position:relative; cursor: pointer; background: var(--bg-color); border: 2px solid var(--text-color); border-radius: 10px; padding: 8px; display: flex; align-items: center; justify-content: center; box-shadow: 2px 2px 0 var(--text-color);">
                    <div class="wallet-growth" id="walletPercent">+0%</div>
                    <svg class="icon-comic" viewBox="0 0 24 24"><path d="M20 12V8H6a2 2 0 0 1-2-2c0-1.1.9-2 2-2h12v4"></path><path d="M4 6v12a2 2 0 0 0 2 2h14v-4"></path><path d="M18 12a2 2 0 0 0-2 2c0 1.1.9 2 2 2h4v-4h-4z"></path></svg>
                </div>
            </div>
        </div>
        <h3><svg class="icon-header" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>KALENDER</h3>
        <div class="premium-card" style="padding: 10px;">
            <div class="calendar-controls"><div class="cal-btn" onclick="changeMonth(-1)">&lt;</div><div class="calendar-header" id="calMonthYear">Bulan Tahun</div><div class="cal-btn" onclick="changeMonth(1)">&gt;</div></div>
            <div class="calendar-grid"><div class="cal-day-name" style="color:var(--holiday-color);">M</div><div class="cal-day-name">S</div><div class="cal-day-name">S</div><div class="cal-day-name">R</div><div class="cal-day-name">K</div><div class="cal-day-name">J</div><div class="cal-day-name">S</div></div>
            <div class="calendar-grid" id="calGrid" style="margin-top:5px;"></div>
            <div id="holidayDesc" class="holiday-desc"></div>
        </div>
        <h3><svg class="icon-header" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>JADWAL SEKOLAH</h3>
        <div class="premium-card"><div class="schedule-grid" id="scheduleGrid"></div></div>
        <h3><svg class="icon-header" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg>MISI HARI INI</h3>
        <div class="premium-card" id="targetList"><p style="text-align:center; color:gray;">Tidak ada misi.</p></div>
    </main>

    <!-- ALL APPS PAGE -->
    <main class="content hidden fast-scroll-container" id="allAppsPage">
        <input type="text" id="appSearchInput" placeholder="Cari Apk..." onkeyup="filterApps()">
        <p style="font-size:0.7rem; text-align:center; margin-bottom:10px; color:gray;">Tahan ikon & geser untuk memindahkan</p>
        <div id="appList" class="app-grid"></div>
    </main>

    <!-- App View Container -->
    <div id="appViewContainer">
        <div class="app-view-header">
            <div class="app-back-btn" onclick="closeWebApp()">
                <svg class="icon-comic" viewBox="0 0 24 24"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                <span style="font-weight:bold; font-family:'Comic Neue'; color:var(--text-color);">Kembali</span>
            </div>
        </div>
        <iframe id="appFrame" class="app-frame" sandbox="allow-scripts allow-same-origin allow-popups allow-forms"></iframe>
    </div>

    <main class="content hidden" id="profilePage">
        <div id="loggedInBlock" class="hidden">
            <div class="profile-card-comic premium-card">
                <img id="profileImg" class="profile-img-comic" src="https://via.placeholder.com/100" onclick="openEditProfile()">
                <h2 id="profileName" style="margin-top:10px; font-family:'Comic Neue';">Username</h2>
                <p id="profileBio" style="font-family:'Patrick Hand';">Bio...</p>
                <div style="font-size:0.8rem; color:gray; margin-top:5px;">(Klik foto untuk edit profil)</div>
            </div>

            <h3><svg class="icon-header" viewBox="0 0 24 24"><path d="M9 18V5l12-2v13"></path><circle cx="6" cy="18" r="3"></circle><circle cx="18" cy="16" r="3"></circle></svg>Playlist Musik</h3>
            <div class="premium-card">
                <div class="music-header">
                    <input type="text" id="musicSearchInput" placeholder="Cari musik..." onkeyup="filterMusic()">
                    <button class="btn-album" onclick="toggleMusicView()">ALBUM</button>
                </div>
                <div id="musicMainView">
                    <div class="music-scroll-area fast-scroll-container" id="musicList">Loading...</div>
                </div>
                <div id="musicAlbumView" class="hidden">
                     <p style="text-align:center; font-size:0.8rem; margin-bottom:10px;">Pilih album atau geser kanan untuk buat baru.</p>
                     <div class="album-list-horizontal" id="musicAlbumListContainer"></div>
                     <div id="selectedAlbumContent" class="hidden" style="margin-top:15px; border-top:2px dashed #333; padding-top:10px;">
                         <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                             <b id="currentMusicAlbumName">Nama Album</b>
                             <button class="btn-comic" style="width:auto; padding:5px 10px; font-size:0.7rem; margin:0;" onclick="openSelectMusicModal()">+ Pilih Musik</button>
                         </div>
                         <div class="music-scroll-area fast-scroll-container" id="musicAlbumTracks"></div>
                     </div>
                </div>
            </div>

            <h3><svg class="icon-header" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>Album Foto & Video</h3>
            <div id="albumHeader" class="album-header-box"></div>
            <div class="premium-card">
                <div class="media-scroll-area fast-scroll-container"><div class="media-grid" id="mediaGallery">Loading...</div></div>
            </div>
        </div>
        
        <div id="notLoggedInBlock" style="text-align:center; padding-top:50px;">
            <h3>Anda Belum Login</h3>
            <p>Login untuk melihat profil dan galeri.</p>
            <button class="btn-comic" onclick="showModal('modalLogin')">LOGIN SEKARANG</button>
        </div>
    </main>

    <nav class="bottom-nav">
        <div class="nav-item active-nav" onclick="switchPage('home')">
            <svg class="icon-comic" viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
            <div style="font-size:0.7rem; font-weight:bold;">Beranda</div>
        </div>
        <div class="nav-item" onclick="switchPage('apps')">
            <svg class="icon-comic" viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
            <div style="font-size:0.7rem; font-weight:bold;">All apk</div>
        </div>
        <div class="nav-item" onclick="switchPage('profile')">
            <svg class="icon-comic" viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
            <div style="font-size:0.7rem; font-weight:bold;">Profil</div>
        </div>
    </nav>

    <div id="audioBar">
        <div class="audio-top"><span id="audioTitle" class="audio-title">Judul Lagu</span><button onclick="stopMusicManual()" style="background:none; border:none; cursor:pointer; color:red; font-weight:bold; font-size:1.2rem;">âœ•</button></div>
        <div class="audio-controls"><button class="bar-play-btn" onclick="togglePlay()"><svg id="playIcon" viewBox="0 0 24 24"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg></button><span id="currTime">0:00</span><input type="range" id="audioSlider" class="audio-slider" min="0" value="0" step="1"><span id="totalTime">0:00</span></div>
    </div>
    <audio id="globalAudio"></audio>

    <!-- MODALS -->
    <div id="modalCreateAlbum" class="modal"><h3>Buat Album Foto Baru</h3><input type="text" id="newAlbumNameInput" placeholder="Nama Album..."><button class="btn-comic" onclick="processCreateAlbum()">Tambahkan</button><button class="btn-comic" style="background:#ddd; color:#333;" onclick="closeModal()">Batal</button></div>
    <div id="modalCreateMusicAlbum" class="modal"><h3>Buat Album Musik Baru</h3><input type="text" id="newMusicAlbumNameInput" placeholder="Nama Album Musik..."><button class="btn-comic" onclick="processCreateMusicAlbum()">Tambahkan</button><button class="btn-comic" style="background:#ddd; color:#333;" onclick="closeModal()">Batal</button></div>
    <div id="modalSelectMusic" class="modal"><h3>Pilih Musik</h3><p style="font-size:0.8rem; text-align:center; margin-bottom:10px;">Pilih lagu untuk ditambahkan ke album.</p><div id="selectMusicList" class="fast-scroll-container" style="max-height:250px; border:1px solid #ccc; padding:5px; margin-bottom:10px;"></div><button class="btn-comic" onclick="addSelectedMusicToAlbum()">Tambahkan ke Album</button><button class="btn-comic" style="background:#ddd; color:#333;" onclick="closeModal()">Batal</button></div>
    <div id="modalDeleteGeneric" class="modal"><h3 id="delGenericTitle">Hapus?</h3><p id="delGenericDesc" style="text-align:center;">Yakin ingin menghapus?</p><button class="btn-comic" style="background:red; color:white;" id="btnConfirmDelGeneric">Hapus</button><button class="btn-comic" style="background:#ddd; color:#333;" onclick="closeModal()">Batal</button></div>
    <div id="modalRenameAlbum" class="modal"><h3>Edit Album Foto</h3><input type="text" id="renameAlbumInput" placeholder="Nama Baru..."><button class="btn-comic" onclick="processRenameAlbum()">Simpan Nama</button><button class="btn-comic" style="background:#ddd; color:#333;" onclick="closeModal()">Batal</button><button class="btn-comic" style="background:red; color:white; margin-top:10px;" onclick="confirmDeleteAlbum()">Hapus Album</button></div>
    <div id="modalAddApp" class="modal"><h3>Tambahkan Apk</h3><div style="text-align:center; margin-bottom:10px;"><div style="width:80px; height:80px; border:2px solid #333; border-radius:10px; margin:0 auto 5px auto; overflow:hidden; background:#eee; display:flex; align-items:center; justify-content:center;"><img id="appIconPreview" style="width:100%; height:100%; object-fit:cover; display:none;"><span id="appIconPlaceholder" style="font-size:0.7rem; color:#555;">Preview</span></div><button class="btn-comic" style="width:auto; font-size:0.8rem;" onclick="document.getElementById('appIconInput').click()">Pilih Ikon</button><input type="file" id="appIconInput" accept="image/*" style="display:none" onchange="previewAppIcon(event)"></div><label style="font-size:0.8rem; font-weight:bold;">Nama Apk</label><input type="text" id="appNameInput" placeholder="Nama Aplikasi"><label style="font-size:0.8rem; font-weight:bold;">Link Website (Wajib)</label><input type="url" id="appLinkInput" placeholder="https://example.com"><button class="btn-comic" onclick="processAddApp()">Tambahkan</button><button class="btn-comic" style="background:#ddd; color:#333;" onclick="closeModal()">Batal</button></div>
    
    <!-- MODAL GANTI NAMA APK -->
    <div id="modalRenameAppSelection" class="modal"><h3>Pilih Apk untuk Diganti Nama</h3><p style="font-size:0.8rem; text-align:center; margin-bottom:10px;">Klik aplikasi yang ingin diubah namanya:</p><div id="renameAppList" class="app-grid fast-scroll-container" style="grid-template-columns: repeat(3, 1fr); max-height:300px;">Loading...</div><button class="btn-comic" style="background:#ddd; color:#333; margin-top:20px;" onclick="closeModal()">Tutup</button></div>
    <div id="modalRenameAppInput" class="modal"><h3>Ganti Nama Apk</h3><p style="text-align:center; font-size:0.9rem;" id="renameTargetName">Nama Lama</p><input type="text" id="newAppNameInput" placeholder="Nama Baru..."><button class="btn-comic" onclick="processRenameApp()">Ganti</button><button class="btn-comic" style="background:#ddd; color:#333;" onclick="closeModal()">Batal</button></div>
    
    <div id="modalDeleteApp" class="modal"><h3>Hapus Aplikasi</h3><p style="font-size:0.8rem; text-align:center; margin-bottom:10px;">Klik aplikasi yang ingin dihapus:</p><div id="deleteAppList" class="app-grid fast-scroll-container" style="grid-template-columns: repeat(3, 1fr); max-height:300px;">Loading...</div><button class="btn-comic" style="background:#ddd; color:#333; margin-top:20px;" onclick="closeModal()">Tutup</button></div>
    <div id="modalMediaOptions" class="modal" style="text-align:center;"><h3>Hapus Media?</h3><p>File ini akan dihapus permanen.</p><button class="btn-comic" style="background:red;" onclick="deleteCurrentMedia()">HAPUS</button><button class="btn-comic" style="background:#ddd; color:#333;" onclick="closeModal()">BATAL</button></div>
    <div id="modalLogin" class="modal"><h3>Login Akun</h3><input type="text" id="loginUser" placeholder="Username"><input type="password" id="loginPass" placeholder="Password"><button class="btn-comic" onclick="login()">Masuk</button><p style="text-align:center; margin-top:10px;">Belum punya akun? <b style="cursor:pointer; color:var(--primary-color)" onclick="switchModal('modalRegister')">Daftar</b></p></div>
    <div id="modalRegister" class="modal"><h3>Daftar Baru</h3><input type="text" id="regUser" placeholder="Username"><input type="password" id="regPass" placeholder="Password"><button class="btn-comic" onclick="register()">Daftar</button><button class="btn-comic" style="background:#ddd; color:#333;" onclick="closeModal()">Batal</button></div>
    <div id="modalEditProfile" class="modal"><h3>Edit Profil</h3><div style="text-align:center;"><img id="previewEditImg" src="" style="width:80px; height:80px; border-radius:50%; border:2px solid #333; object-fit: cover;"><br><button class="btn-comic" style="width:auto; font-size:0.8rem; margin-top: 10px; display:inline-flex; align-items:center; gap:5px;" onclick="document.getElementById('fileProfile').click()"><svg class="icon-comic" style="width:18px; height:18px; stroke:white;" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg> Pilih dari Galeri</button><input type="file" id="fileProfile" accept="image/*" hidden onchange="previewProfilePic(event)"></div><label style="margin-top:10px; display:block; font-weight:bold;">Username:</label><input type="text" id="editUsernameInput"><label style="margin-top:10px; display:block; font-weight:bold;">Bio:</label><textarea id="editBioInput" rows="3"></textarea><button class="btn-comic" onclick="saveProfileChanges()">Simpan Perubahan</button><button class="btn-comic" style="background:#ddd; color:#333;" onclick="closeModal()">Batal</button></div>
    <div id="modalAlbum" class="modal"><h3 style="text-align:center;">Pilih Upload</h3><div class="upload-options"><div class="upload-icon-btn" onclick="document.getElementById('uploadMusic').click()"><svg class="upload-svg" viewBox="0 0 24 24"><path d="M9 18V5l12-2v13"></path><circle cx="6" cy="18" r="3"></circle><circle cx="18" cy="16" r="3"></circle></svg><span style="font-size:0.8rem; font-weight:bold;">MUSIK</span></div><div class="upload-icon-btn" onclick="document.getElementById('uploadFoto').click()"><svg class="upload-svg" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg><span style="font-size:0.8rem; font-weight:bold;">FOTO</span></div><div class="upload-icon-btn" onclick="document.getElementById('uploadVideo').click()"><svg class="upload-svg" viewBox="0 0 24 24"><polygon points="23 7 16 12 23 17 23 7"></polygon><rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect></svg><span style="font-size:0.8rem; font-weight:bold;">VIDEO</span></div></div><button class="btn-comic" style="background:#ddd; color:#333; margin-top:20px;" onclick="closeModal()">Batal</button><input type="file" id="uploadMusic" accept="audio/*" hidden onchange="processUpload(event, 'music')"><input type="file" id="uploadFoto" accept="image/*" hidden onchange="processUpload(event, 'photo')"><input type="file" id="uploadVideo" accept="video/*" hidden onchange="processUpload(event, 'video')"></div>
    <div id="modalWithdraw" class="modal"><h3>Tarik Tunai</h3><p>Saldo saat ini: <b id="withdrawBalance">0</b></p><input type="number" id="withdrawAmount" placeholder="Jumlah penarikan..."><button class="btn-comic" onclick="processWithdraw()">Tarik Sekarang</button><button class="btn-comic" style="background:#ddd; color:#333;" onclick="closeModal()">Batal</button></div>
    <div id="modalReceipt" class="modal"><h3>Penarikan Berhasil!</h3><div id="receiptContent"></div><button class="btn-comic" onclick="closeModal()">Tutup</button></div>
    <div id="modalUang" class="modal"><h3>Input Uang</h3><input type="number" id="inputAmount" placeholder="Nominal"><button class="btn-comic" onclick="addMoney()">Simpan</button><button class="btn-comic" style="background:#ddd; color:#333;" onclick="closeModal()">Batal</button></div>
    <div id="modalWalletDetail" class="modal"><h3>Riwayat</h3><div id="historyList" class="fast-scroll-container" style="max-height:200px; border:1px solid #ccc; padding:5px;"></div><button class="btn-comic" onclick="closeModal()">Tutup</button></div>
    <div id="modalMapel" class="modal"><h3>Edit Jadwal</h3><select id="daySelect"><option>Senin</option><option>Selasa</option><option>Rabu</option><option>Kamis</option><option>Jumat</option></select><input type="text" id="mapelInput" placeholder="Mapel (pisahkan koma)"><button class="btn-comic" onclick="saveMapel()">Simpan</button><button class="btn-comic" style="background:#ddd; color:#333;" onclick="closeModal()">Batal</button></div>
    <div id="modalTarget" class="modal"><h3>Tambah Misi</h3><input type="text" id="targetInput" placeholder="Target..."><button class="btn-comic" onclick="addTarget()">Tambah</button><button class="btn-comic" style="background:#ddd; color:#333;" onclick="closeModal()">Batal</button></div>
    <div id="modalImport" class="modal"><h3>Masukan Data</h3><p style="font-size:0.8rem;">Pilih file JSON backup. Proses mungkin lama jika file besar.</p><input type="file" id="importFile" accept=".json"><button class="btn-comic" id="btnRestore" onclick="importData()">Proses Data</button><button class="btn-comic" style="background:#ddd; color:#333;" onclick="closeModal()">Batal</button></div>

    <script>
        const DB_NAME = "DixzMegaDB";
        const DB_VERSION = 1;
        let db;
        const dailyMotivations = ["Percaya pada diri sendiri.", "Jangan berhenti saat lelah.", "Kesalahan adalah bukti mencoba.", "Setiap hari kesempatan baru.", "Mimpi besar mulai dari langkah kecil.", "Fokus pada proses.", "Hari ini hari yang baik.", "Jangan takut gagal.", "Usaha tidak mengkhianati hasil.", "Jadilah versi terbaik.", "Sukses adalah upaya kecil berulang.", "Mulai sekarang.", "Disiplin adalah jembatan.", "Tetap semangat."];

        function initDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);
                request.onupgradeneeded = (e) => { db = e.target.result; if (!db.objectStoreNames.contains("media")) { const store = db.createObjectStore("media", { keyPath: "id", autoIncrement: true }); store.createIndex("user", "user", { unique: false }); } };
                request.onsuccess = (e) => { db = e.target.result; resolve(db); };
                request.onerror = (e) => reject("DB Error");
            });
        }
        async function saveMediaToDB(user, type, fileBlob, name, albumNameOrUrl) {
            return new Promise((resolve, reject) => { const tx = db.transaction(["media"], "readwrite"); const store = tx.objectStore("media"); const item = { user: user, type: type, blob: fileBlob, name: name, created: new Date() }; if(type === 'web_app') item.url = albumNameOrUrl; else item.album = albumNameOrUrl; store.add(item); tx.oncomplete = () => resolve(); tx.onerror = () => reject(); });
        }
        async function getMediaFromDB(user) {
            return new Promise((resolve) => { const tx = db.transaction(["media"], "readonly"); const store = tx.objectStore("media"); const index = store.index("user"); const request = index.getAll(user); request.onsuccess = () => resolve(request.result); });
        }
        async function deleteMediaFromDB(id) {
            return new Promise((resolve) => { const tx = db.transaction(["media"], "readwrite"); const store = tx.objectStore("media"); store.delete(id); tx.oncomplete = () => resolve(); });
        }
        async function updateAppNameInDB(id, newName) {
            return new Promise((resolve, reject) => { const tx = db.transaction(["media"], "readwrite"); const store = tx.objectStore("media"); const req = store.get(id); req.onsuccess = () => { const data = req.result; if(data && data.type === 'web_app') { data.name = newName; store.put(data); resolve(); } else reject("App Not Found"); }; req.onerror = () => reject("DB Error"); });
        }
        async function migrateMediaUser(oldUser, newUser) { const items = await getMediaFromDB(oldUser); const tx = db.transaction(["media"], "readwrite"); const store = tx.objectStore("media"); for (const item of items) { item.user = newUser; store.put(item); } }
        async function updateMediaAlbum(user, oldAlbum, newAlbum) { const items = await getMediaFromDB(user); const tx = db.transaction(["media"], "readwrite"); const store = tx.objectStore("media"); for (const item of items) { if((item.album || user) === oldAlbum) { item.album = newAlbum; store.put(item); } } }

        let allAppsList = [], dragSrcEl = null;
        function previewAppIcon(e) { const file = e.target.files[0]; if(file) { const url = URL.createObjectURL(file); const img = document.getElementById('appIconPreview'); img.src = url; img.style.display = 'block'; document.getElementById('appIconPlaceholder').style.display = 'none'; } }
        async function processAddApp() { if(!currentUser) return; const iconInput = document.getElementById('appIconInput').files[0]; const name = document.getElementById('appNameInput').value; const url = document.getElementById('appLinkInput').value; if(!iconInput || !name || !url) return alert("Isi semua!"); await saveMediaToDB(currentUser, 'web_app', iconInput, name, url); closeModal(); setTimeout(() => loadApps(), 100); }
        async function loadApps() { if(!currentUser) return; const items = await getMediaFromDB(currentUser); let rawApps = items.filter(i => i.type === 'web_app'); let order = JSON.parse(localStorage.getItem(`app_order_${currentUser}`) || "[]"); if(order.length > 0) rawApps.sort((a, b) => { let idxA = order.indexOf(a.id); let idxB = order.indexOf(b.id); return (idxA === -1 ? 9999 : idxA) - (idxB === -1 ? 9999 : idxB); }); allAppsList = rawApps; renderApps(allAppsList); }
        function renderApps(apps) { const appList = document.getElementById('appList'); appList.innerHTML = ''; if(apps.length === 0) { appList.innerHTML = '<p style="grid-column:span 4; text-align:center; padding:20px;">Aplikasi tidak ditemukan.</p>'; return; } apps.forEach(app => { const iconUrl = URL.createObjectURL(app.blob); const div = document.createElement('div'); div.className = 'app-item'; div.draggable = true; div.setAttribute('data-id', app.id); div.onclick = (e) => { if(!div.classList.contains('dragging-mode')) openWebApp(app.url); }; div.innerHTML = `<div class="app-icon-box"><img src="${iconUrl}" draggable="false"></div><div class="app-name">${app.name}</div>`; div.addEventListener('dragstart', handleDragStart); div.addEventListener('dragover', handleDragOver); div.addEventListener('drop', handleDrop); div.addEventListener('dragend', handleDragEnd); div.addEventListener('touchstart', handleTouchStart, {passive: false}); div.addEventListener('touchmove', handleTouchMove, {passive: false}); div.addEventListener('touchend', handleTouchEnd); appList.appendChild(div); }); }
        
        function handleDragStart(e) { this.style.opacity = '0.4'; dragSrcEl = this; e.dataTransfer.effectAllowed = 'move'; e.dataTransfer.setData('text/plain', this.getAttribute('data-id')); }
        function handleDragOver(e) { if (e.preventDefault) e.preventDefault(); e.dataTransfer.dropEffect = 'move'; return false; }
        function handleDrop(e) { if (e.stopPropagation) e.stopPropagation(); if (dragSrcEl !== this) { const srcId = parseInt(dragSrcEl.getAttribute('data-id')); const targetId = parseInt(this.getAttribute('data-id')); const srcIdx = allAppsList.findIndex(a => a.id === srcId); const targetIdx = allAppsList.findIndex(a => a.id === targetId); if(srcIdx > -1 && targetIdx > -1) { const temp = allAppsList[srcIdx]; allAppsList.splice(srcIdx, 1); allAppsList.splice(targetIdx, 0, temp); localStorage.setItem(`app_order_${currentUser}`, JSON.stringify(allAppsList.map(a => a.id))); renderApps(allAppsList); } } return false; }
        function handleDragEnd(e) { this.style.opacity = '1'; }
        let touchTimer = null;
        function handleTouchStart(e) { const touch = e.touches[0]; this.startX = touch.clientX; this.startY = touch.clientY; touchTimer = setTimeout(() => { this.classList.add('dragging', 'dragging-mode'); if(navigator.vibrate) navigator.vibrate(50); }, 500); }
        function handleTouchMove(e) { if(this.classList.contains('dragging')) { e.preventDefault(); const touch = e.touches[0]; this.style.position = 'absolute'; this.style.left = (touch.clientX - 40) + 'px'; this.style.top = (touch.clientY - 40) + 'px'; this.style.zIndex = '1000'; } else { const touch = e.touches[0]; if(Math.abs(touch.clientX - this.startX) > 10 || Math.abs(touch.clientY - this.startY) > 10) clearTimeout(touchTimer); } }
        function handleTouchEnd(e) { clearTimeout(touchTimer); if(this.classList.contains('dragging')) { this.classList.remove('dragging'); this.style.position = ''; this.style.left = ''; this.style.top = ''; this.style.zIndex = ''; const touch = e.changedTouches[0]; const target = document.elementFromPoint(touch.clientX, touch.clientY); const targetApp = target ? target.closest('.app-item') : null; if(targetApp && targetApp !== this) { const srcId = parseInt(this.getAttribute('data-id')); const targetId = parseInt(targetApp.getAttribute('data-id')); const srcIdx = allAppsList.findIndex(a => a.id === srcId); const targetIdx = allAppsList.findIndex(a => a.id === targetId); if(srcIdx > -1 && targetIdx > -1) { const temp = allAppsList[srcIdx]; allAppsList.splice(srcIdx, 1); allAppsList.splice(targetIdx, 0, temp); localStorage.setItem(`app_order_${currentUser}`, JSON.stringify(allAppsList.map(a => a.id))); } } renderApps(allAppsList); setTimeout(() => { this.classList.remove('dragging-mode'); }, 100); } }

        async function loadDeleteAppList() { if(!currentUser) return; const items = await getMediaFromDB(currentUser); const apps = items.filter(i => i.type === 'web_app'); const container = document.getElementById('deleteAppList'); container.innerHTML = ''; if(apps.length === 0) { container.innerHTML = '<p style="grid-column:span 3; text-align:center;">Tidak ada aplikasi.</p>'; return; } apps.forEach(app => { const iconUrl = URL.createObjectURL(app.blob); const div = document.createElement('div'); div.className = 'app-item'; div.onclick = () => confirmDeleteApp(app.id, app.name); div.innerHTML = `<div class="app-icon-box" style="border-color:red;"><img src="${iconUrl}"></div><div class="app-name">${app.name}</div>`; container.appendChild(div); }); }
        async function confirmDeleteApp(id, name) { if(confirm(`Hapus aplikasi "${name}"?`)) { await deleteMediaFromDB(id); loadDeleteAppList(); loadApps(); } }
        
        async function loadRenameAppList() { if(!currentUser) return; const items = await getMediaFromDB(currentUser); const apps = items.filter(i => i.type === 'web_app'); const container = document.getElementById('renameAppList'); container.innerHTML = ''; if(apps.length === 0) { container.innerHTML = '<p style="grid-column:span 3; text-align:center;">Tidak ada aplikasi.</p>'; return; } apps.forEach(app => { const iconUrl = URL.createObjectURL(app.blob); const div = document.createElement('div'); div.className = 'app-item'; div.onclick = () => openRenameInput(app.id, app.name); div.innerHTML = `<div class="app-icon-box"><img src="${iconUrl}"></div><div class="app-name">${app.name}</div>`; container.appendChild(div); }); }
        let appToRenameId = null;
        function openRenameInput(id, oldName) { appToRenameId = id; document.getElementById('renameTargetName').innerText = `Ubah: ${oldName}`; document.getElementById('newAppNameInput').value = oldName; showModal('modalRenameAppInput'); }
        async function processRenameApp() { const newName = document.getElementById('newAppNameInput').value.trim(); if(!newName) return alert("Isi nama!"); if(appToRenameId) { await updateAppNameInDB(appToRenameId, newName); loadApps(); loadRenameAppList(); showModal('modalRenameAppSelection'); } }

        function filterApps() { const query = document.getElementById('appSearchInput').value.toLowerCase(); const filtered = allAppsList.filter(app => app.name.toLowerCase().includes(query)); renderApps(filtered); }
        let isAppOpen = false;
        function openWebApp(url) { const container = document.getElementById('appViewContainer'); const frame = document.getElementById('appFrame'); frame.src = url; container.style.display = 'flex'; isAppOpen = true; }
        function closeWebApp() { const container = document.getElementById('appViewContainer'); const frame = document.getElementById('appFrame'); frame.src = ''; container.style.display = 'none'; isAppOpen = false; }

        let currentUser = null, accounts = {}, currentAlbum = "", userAlbums = [], musicAlbums = {}, currentMusicAlbum = null;
        const defaultUser = { saldo: 0, history: [], schedule: { "Senin": ["-","-"], "Selasa": ["-","-"], "Rabu": ["-","-"], "Kamis": ["-","-"], "Jumat": ["-","-"] }, targets: [], bio: "Halo dunia!", profilePic: "https://via.placeholder.com/100" };

        window.onload = async function() {
            document.getElementById('splashProgress').style.width = "100%"; await initDB(); loadTextData(); checkSession(); renderCalendar(currentMonth, currentYear); renderUI(); loadApps();
            setTimeout(() => { const s = document.getElementById('splash-screen'); s.style.opacity = '0'; setTimeout(() => s.style.visibility = 'hidden', 800); }, 1500);
            document.querySelector('.sidebar').addEventListener('click', (e) => e.stopPropagation());
            const audio = document.getElementById('globalAudio'); const slider = document.getElementById('audioSlider');
            audio.addEventListener('timeupdate', () => { if(audio.duration) { slider.max = Math.floor(audio.duration); slider.value = Math.floor(audio.currentTime); document.getElementById('currTime').innerText = formatTime(audio.currentTime); document.getElementById('totalTime').innerText = formatTime(audio.duration); }});
            slider.addEventListener('input', () => audio.currentTime = slider.value);
        };
        function formatTime(s) { if(isNaN(s)) return "0:00"; const m = Math.floor(s/60); const sec = Math.floor(s%60); return `${m}:${sec<10?'0':''}${sec}`; }
        function loadTextData() { const data = localStorage.getItem('dixz_accounts_text'); accounts = data ? JSON.parse(data) : {}; }
        function saveTextData() { localStorage.setItem('dixz_accounts_text', JSON.stringify(accounts)); renderUI(); }
        function checkSession() { const sess = localStorage.getItem('dixz_session'); if(sess && accounts[sess]) { currentUser = sess; initAlbums(); initMusicAlbums(); } }
        function initAlbums() { const stored = localStorage.getItem(`dixz_albums_${currentUser}`); if(stored) userAlbums = JSON.parse(stored); else { userAlbums = [currentUser]; localStorage.setItem(`dixz_albums_${currentUser}`, JSON.stringify(userAlbums)); } currentAlbum = userAlbums[0]; }
        function initMusicAlbums() { const stored = localStorage.getItem(`dixz_music_albums_${currentUser}`); musicAlbums = stored ? JSON.parse(stored) : {}; }
        function saveMusicAlbums() { localStorage.setItem(`dixz_music_albums_${currentUser}`, JSON.stringify(musicAlbums)); renderMusicAlbums(); }
        
        function renderAlbumTabs() {
            const container = document.getElementById('albumHeader'); container.innerHTML = '';
            userAlbums.forEach(album => { const span = document.createElement('span'); span.className = `album-tab ${album===currentAlbum?'active':''}`; span.innerText = album; let timer; const start = () => timer = setTimeout(() => showRenameAlbumModal(album), 1000); const cancel = () => clearTimeout(timer); span.onmousedown = start; span.onmouseup = cancel; span.onmouseleave = cancel; span.ontouchstart = start; span.ontouchend = cancel; span.onclick = () => switchAlbum(album); container.appendChild(span); });
            const addBtn = document.createElement('span'); addBtn.className = 'album-tab album-add-btn'; addBtn.innerText = '+ Tambah'; addBtn.onclick = () => { document.getElementById('newAlbumNameInput').value = ""; showModal('modalCreateAlbum'); }; container.appendChild(addBtn);
        }
        function switchAlbum(name) { currentAlbum = name; renderAlbumTabs(); loadMedia(); }
        function processCreateAlbum() { const name = document.getElementById('newAlbumNameInput').value.trim(); if(name) { if(userAlbums.includes(name)) return alert("Ada!"); userAlbums.push(name); localStorage.setItem(`dixz_albums_${currentUser}`, JSON.stringify(userAlbums)); switchAlbum(name); closeModal(); } }
        let albumToRename = "";
        function showRenameAlbumModal(name) { albumToRename = name; document.getElementById('renameAlbumInput').value = name; showModal('modalRenameAlbum'); }
        async function processRenameAlbum() { const newName = document.getElementById('renameAlbumInput').value.trim(); if(newName && newName !== albumToRename) { if(userAlbums.includes(newName)) return alert("Ada!"); const idx = userAlbums.indexOf(albumToRename); if(idx !== -1) userAlbums[idx] = newName; localStorage.setItem(`dixz_albums_${currentUser}`, JSON.stringify(userAlbums)); await updateMediaAlbum(currentUser, albumToRename, newName); if(currentAlbum === albumToRename) currentAlbum = newName; closeModal(); renderAlbumTabs(); loadMedia(); } else closeModal(); }
        async function confirmDeleteAlbum() { if(confirm("Hapus album?")) { userAlbums = userAlbums.filter(a => a !== albumToRename); if(!userAlbums.length) userAlbums.push(currentUser); localStorage.setItem(`dixz_albums_${currentUser}`, JSON.stringify(userAlbums)); const items = await getMediaFromDB(currentUser); const tx = db.transaction(["media"], "readwrite"); const store = tx.objectStore("media"); items.forEach(i => { if((i.album||currentUser) === albumToRename) store.delete(i.id); }); if(currentAlbum === albumToRename) currentAlbum = userAlbums[0]; alert("Dihapus."); closeModal(); renderAlbumTabs(); loadMedia(); } }

        function register() { const u = document.getElementById('regUser').value.trim(), p = document.getElementById('regPass').value; if(!u||!p) return alert("Isi!"); accounts[u] = { password: p, ...JSON.parse(JSON.stringify(defaultUser)) }; saveTextData(); alert("OK Login"); switchModal('modalLogin'); }
        function login() { const u = document.getElementById('loginUser').value.trim(), p = document.getElementById('loginPass').value; if(accounts[u] && accounts[u].password === p) { currentUser = u; localStorage.setItem('dixz_session', u); closeModal(); location.reload(); } else alert("Salah!"); }
        function doLogout() { if(confirm("Keluar?")) { currentUser = null; localStorage.removeItem('dixz_session'); stopMusicManual(); location.reload(); } }
        function checkAuth(id, cb) { if(!currentUser) showModal('modalLogin'); else { if(id === 'modalWithdraw') showWithdrawModal(); else if(id) showModal(id); if(cb) cb(); } }

        let currentMonth = new Date().getMonth(), currentYear = new Date().getFullYear();
        const holidays = { "1-1": "Tahun Baru", "17-8": "HUT RI", "25-12": "Natal" };
        function changeMonth(d) { currentMonth += d; if(currentMonth > 11) { currentMonth = 0; currentYear++; } if(currentMonth < 0) { currentMonth = 11; currentYear--; } renderCalendar(currentMonth, currentYear); }
        function renderCalendar(m, y) {
            const months = ["Jan","Feb","Mar","Apr","Mei","Jun","Jul","Agu","Sep","Okt","Nov","Des"]; document.getElementById('calMonthYear').innerText = `${months[m]} ${y}`;
            const first = new Date(y, m, 1).getDay(), days = new Date(y, m + 1, 0).getDate(), grid = document.getElementById('calGrid');
            grid.innerHTML = ''; for(let i=0; i<first; i++) grid.innerHTML += `<div></div>`;
            for(let i=1; i<=days; i++) {
                const isSun = new Date(y, m, i).getDay() === 0, key = `${i}-${m+1}`;
                let cl = "cal-date" + (isSun || holidays[key] ? " holiday" : "");
                if(i === new Date().getDate() && m === new Date().getMonth()) cl += " today";
                const q = holidays[key] || (isSun ? "Minggu" : dailyMotivations[(i+m+y)%dailyMotivations.length]);
                grid.innerHTML += `<div class="${cl}" onclick="document.getElementById('holidayDesc').innerText='${q.replace(/'/g,"\\'")}'">${i}</div>`;
            }
        }
        function renderUI() {
            if(currentUser) { const d = accounts[currentUser]; document.getElementById('welcomeText').innerText = `Hai, ${currentUser}!`; document.getElementById('displaySaldo').innerText = d.saldo.toLocaleString(); document.getElementById('walletPercent').innerText = d.saldo>0?`+${((d.saldo/1000)*1).toFixed(0)}%`:"0%"; document.getElementById('loggedInBlock').classList.remove('hidden'); document.getElementById('notLoggedInBlock').classList.add('hidden'); document.getElementById('profileName').innerText = currentUser; document.getElementById('profileBio').innerText = d.bio; document.getElementById('profileImg').src = d.profilePic; const tList = document.getElementById('targetList'); tList.innerHTML = d.targets.length ? d.targets.map((t,i)=>`<div style="display:flex;justify-content:space-between;border-bottom:1px dashed #ccc;padding:5px;"><span>${t}</span><span style="color:red;cursor:pointer" onclick="delTarget(${i})">X</span></div>`).join('') : '<p style="text-align:center;">Kosong</p>'; renderSchedule(d.schedule); renderAlbumTabs(); loadMedia(); }
            else { document.getElementById('loggedInBlock').classList.add('hidden'); document.getElementById('notLoggedInBlock').classList.remove('hidden'); renderSchedule(defaultUser.schedule); }
        }
        function renderSchedule(s) { const g = document.getElementById('scheduleGrid'); g.innerHTML = ''; ["Sn","Sl","Rb","Km","Jm"].forEach(d=>g.innerHTML+=`<div class="schedule-header">${d}</div>`); let max=2; for(let k in s) if(s[k].length>max) max=s[k].length; for(let i=0; i<max; i++) ["Senin","Selasa","Rabu","Kamis","Jumat"].forEach(d => g.innerHTML += `<div class="schedule-cell">${s[d][i]||""}</div>`); }

        let selectedMediaId = null, allMusicList = [], currentPlaylist = [], currentTrackIndex = -1, allGalleryItems = [];
        async function loadMedia() {
            if(!currentUser) return; const items = await getMediaFromDB(currentUser);
            const gal = document.getElementById('mediaGallery'); gal.innerHTML = '';
            allMusicList = []; currentPlaylist = []; allGalleryItems = [];
            items.forEach(i => { const url = URL.createObjectURL(i.blob); if(i.type === 'music') allMusicList.push({ name: i.name, url: url, id: i.id }); else if((i.album||currentUser) === currentAlbum) allGalleryItems.push({ ...i, url: url }); });
            currentPlaylist = allMusicList; renderMusicList(allMusicList);
            if(!allGalleryItems.length) gal.innerHTML = '<p style="grid-column:span 2;text-align:center;">Kosong.</p>';
            allGalleryItems.forEach(i => {
                const d = document.createElement('div'); d.className = 'media-box';
                let timer; const start = () => timer = setTimeout(() => showMediaMenu(i.id), 800); const end = () => clearTimeout(timer);
                d.onmousedown = start; d.ontouchstart = start; d.onmouseup = () => { clearTimeout(timer); if(document.getElementById('modalMediaOptions').style.display === 'none') viewMedia(i.id); }; d.ontouchend = () => { clearTimeout(timer); if(document.getElementById('modalMediaOptions').style.display === 'none') viewMedia(i.id); }; d.onmouseleave = end;
                d.innerHTML = i.type === 'photo' ? `<img src="${i.url}">` : `<video src="${i.url}#t=0.1"></video>`; gal.appendChild(d);
            });
        }
        function renderMusicList(list, id='musicList') {
            const div = document.getElementById(id); div.innerHTML = ''; if(!list.length) div.innerHTML = "<p>Kosong</p>";
            list.forEach((t, i) => div.innerHTML += `<div class="music-item"><button class="btn-play-stylish" onclick="playTrack(${i}, '${id}')">â–¶</button><div class="music-info-box">${t.name}</div><button class="btn-options" onclick="confirmDeleteMusic(${t.id})">â‹®</button></div>`);
        }
        function toggleMusicView(force) {
            const m = document.getElementById('musicMainView'), a = document.getElementById('musicAlbumView'), b = document.querySelector('.btn-album');
            if(force==='albums' || !a.classList.contains('hidden')) { a.classList.add('hidden'); m.classList.remove('hidden'); b.innerText = "ALBUM"; currentPlaylist = allMusicList; }
            else { m.classList.add('hidden'); a.classList.remove('hidden'); b.innerText = "LIST"; renderMusicAlbums(); }
        }
        function renderMusicAlbums() {
            const c = document.getElementById('musicAlbumListContainer'); c.innerHTML = '<div class="music-album-card create-album-card" onclick="document.getElementById(\'newMusicAlbumNameInput\').value=\'\';showModal(\'modalCreateMusicAlbum\')"><span>+</span></div>';
            for(let n in musicAlbums) { const d = document.createElement('div'); d.className = 'music-album-card'; d.innerHTML = `<span>${n}</span>`; let timer; d.onmousedown = () => timer = setTimeout(() => confirmDelMusAlb(n), 1000); d.onmouseup = () => clearTimeout(timer); d.onclick = () => openMusicAlbum(n); c.appendChild(d); }
        }
        function processCreateMusicAlbum() { const n = document.getElementById('newMusicAlbumNameInput').value.trim(); if(n && !musicAlbums[n]) { musicAlbums[n] = []; saveMusicAlbums(); closeModal(); renderMusicAlbums(); } }
        function confirmDelMusAlb(n) { if(confirm("Hapus album "+n+"?")) { delete musicAlbums[n]; saveMusicAlbums(); closeModal(); renderMusicAlbums(); document.getElementById('selectedAlbumContent').classList.add('hidden'); } }
        function openMusicAlbum(n) { currentMusicAlbum = n; document.getElementById('currentMusicAlbumName').innerText = n; document.getElementById('selectedAlbumContent').classList.remove('hidden'); const tracks = allMusicList.filter(m => musicAlbums[n].includes(m.id)); currentPlaylist = tracks; renderMusicList(tracks, 'musicAlbumTracks'); }
        function openSelectMusicModal() { const l = document.getElementById('selectMusicList'); l.innerHTML = ''; allMusicList.forEach(m => l.innerHTML += `<div style="padding:5px;border-bottom:1px solid #eee;"><input type="checkbox" class="cb" value="${m.id}" ${musicAlbums[currentMusicAlbum].includes(m.id)?'checked disabled':''}> ${m.name}</div>`); showModal('modalSelectMusic'); }
        function addSelectedMusicToAlbum() { document.querySelectorAll('.cb:checked:not([disabled])').forEach(c => musicAlbums[currentMusicAlbum].push(parseInt(c.value))); saveMusicAlbums(); closeModal(); openMusicAlbum(currentMusicAlbum); }
        function confirmDeleteMusic(id) { if(confirm("Hapus lagu?")) { if(document.getElementById('musicAlbumView').classList.contains('hidden')) deleteMediaFromDB(id).then(()=>{ for(let k in musicAlbums) musicAlbums[k]=musicAlbums[k].filter(x=>x!==id); saveMusicAlbums(); loadMedia(); }); else { musicAlbums[currentMusicAlbum] = musicAlbums[currentMusicAlbum].filter(x => x !== id); saveMusicAlbums(); openMusicAlbum(currentMusicAlbum); } } }
        function filterMusic() { const q = document.getElementById('musicSearchInput').value.toLowerCase(); renderMusicList(currentPlaylist.filter(t => t.name.toLowerCase().includes(q)), document.getElementById('musicAlbumView').classList.contains('hidden') ? 'musicList' : 'musicAlbumTracks'); }
        function showMediaMenu(id) { selectedMediaId = id; showModal('modalMediaOptions'); }
        async function deleteCurrentMedia() { await deleteMediaFromDB(selectedMediaId); closeModal(); loadMedia(); }
        
        function playTrack(idx) { if(idx >= currentPlaylist.length) idx=0; if(idx<0) return; currentTrackIndex = idx; const t = currentPlaylist[idx]; document.getElementById('globalAudio').src = t.url; document.getElementById('globalAudio').play(); document.getElementById('audioBar').style.display='flex'; document.getElementById('audioTitle').innerText = t.name; document.getElementById('playIcon').innerHTML = '<rect x="6" y="6" width="4" height="12"/><rect x="14" y="6" width="4" height="12"/>'; }
        document.getElementById('globalAudio').onended = () => playTrack(currentTrackIndex + 1);
        function togglePlay() { const a = document.getElementById('globalAudio'); if(a.paused) { a.play(); document.getElementById('playIcon').innerHTML = '<rect x="6" y="6" width="4" height="12"/><rect x="14" y="6" width="4" height="12"/>'; } else { a.pause(); document.getElementById('playIcon').innerHTML = '<polygon points="5 3 19 12 5 21 5 3"></polygon>'; } }
        function stopMusicManual() { document.getElementById('globalAudio').pause(); document.getElementById('audioBar').style.display='none'; }
        
        function viewMedia(id) { const c = document.getElementById('previewCarousel'); c.innerHTML = ''; let idx = 0; allGalleryItems.forEach((it, i) => { if(it.id===id) idx=i; const d = document.createElement('div'); d.className = 'preview-item'; d.innerHTML = it.type === 'photo' ? `<img src="${it.url}">` : `<video src="${it.url}" controls></video>`; c.appendChild(d); }); document.getElementById('previewOverlay').style.display='flex'; setTimeout(() => document.querySelectorAll('.preview-item')[idx].scrollIntoView(), 100); }
        function closePreview() { document.getElementById('previewOverlay').style.display='none'; document.getElementById('previewCarousel').innerHTML=''; }

        function showWithdrawModal() { if(!currentUser) return showModal('modalLogin'); document.getElementById('withdrawBalance').innerText = accounts[currentUser].saldo.toLocaleString(); showModal('modalWithdraw'); }
        function processWithdraw() { const a = parseInt(document.getElementById('withdrawAmount').value); if(a>accounts[currentUser].saldo) return alert("Kurang!"); accounts[currentUser].saldo -= a; accounts[currentUser].history.unshift(`- ${a}`); saveTextData(); document.getElementById('receiptContent').innerHTML = `<h3>STRUK</h3><p>Rp ${a}</p><p>Sisa: ${accounts[currentUser].saldo}</p>`; closeModal(); showModal('modalReceipt'); }
        function addMoney() { const v = parseInt(document.getElementById('inputAmount').value); if(v) { accounts[currentUser].saldo += v; accounts[currentUser].history.unshift(`+ ${v}`); saveTextData(); closeModal(); } }
        function saveMapel() { accounts[currentUser].schedule[document.getElementById('daySelect').value] = document.getElementById('mapelInput').value.split(','); saveTextData(); closeModal(); }
        function addTarget() { accounts[currentUser].targets.push(document.getElementById('targetInput').value); saveTextData(); closeModal(); }
        function delTarget(i) { accounts[currentUser].targets.splice(i,1); saveTextData(); }
        
        async function saveProfileChanges() { const n = document.getElementById('editUsernameInput').value.trim(); if(n!==currentUser) { accounts[n] = accounts[currentUser]; await migrateMediaUser(currentUser, n); delete accounts[currentUser]; localStorage.setItem('dixz_session', n); currentUser = n; } accounts[currentUser].bio = document.getElementById('editBioInput').value; accounts[currentUser].profilePic = tempImg; saveTextData(); closeModal(); }
        async function exportData() { if(!currentUser || !confirm("Backup?")) return; const m = await getMediaFromDB(currentUser); const me = []; for(const i of m) me.push({ type: i.type, name: i.name, data: await blobToBase64(i.blob), url: i.url }); const b = new Blob([JSON.stringify({ user: accounts[currentUser], media: me })], {type: "application/json"}); const a = document.createElement('a'); a.href = URL.createObjectURL(b); a.download = `Backup_${currentUser}.json`; a.click(); }
        function blobToBase64(b) { return new Promise(r => { const rd = new FileReader(); rd.onloadend = () => r(rd.result); rd.readAsDataURL(b); }); }
        function base64ToBlob(b64) { const arr = b64.split(','), mime = arr[0].match(/:(.*?);/)[1], bstr = atob(arr[1]); let n = bstr.length, u8 = new Uint8Array(n); while(n--) u8[n] = bstr.charCodeAt(n); return new Blob([u8], {type: mime}); }
        async function importData() { const f = document.getElementById('importFile').files[0]; if(!f) return; const rd = new FileReader(); rd.onload = async function(e) { try { const j = JSON.parse(e.target.result); if(!currentUser) currentUser = "RestoredUser"; accounts[currentUser] = j.user; saveTextData(); localStorage.setItem('dixz_session', currentUser); if(j.media) for(const m of j.media) if(m.type==='web_app') { const tx = db.transaction(["media"], "readwrite"); tx.objectStore("media").add({ user: currentUser, type: m.type, blob: base64ToBlob(m.data), name: m.name, url: m.url, created: new Date() }); } else await saveMediaToDB(currentUser, m.type, base64ToBlob(m.data), m.name); alert("OK"); location.reload(); } catch(err) { alert("Gagal"); } }; rd.readAsText(f); }

        function toggleSidebar() { const s = document.getElementById('sidebar'); if(s.classList.contains('active')) { s.classList.remove('active'); document.getElementById('overlay').style.display='none'; } else { s.classList.add('active'); document.getElementById('overlay').style.display='block'; } }
        function closeAll() { document.getElementById('sidebar').classList.remove('active'); document.querySelectorAll('.modal').forEach(m => m.style.display='none'); document.getElementById('overlay').style.display='none'; }
        function showModal(id) { closeAll(); document.getElementById('overlay').style.display='block'; document.getElementById(id).style.display='block'; if(id === 'modalWalletDetail' && currentUser) document.getElementById('historyList').innerHTML = accounts[currentUser].history.map(x=>`<div>${x}</div>`).join(''); }
        function switchModal(id) { closeAll(); showModal(id); }
        function closeModal() { closeAll(); }
        function toggleDarkMode() { document.body.classList.toggle('dark-mode'); localStorage.setItem('dixz_theme', document.body.classList.contains('dark-mode')?'dark':'light'); closeAll(); }
        if(localStorage.getItem('dixz_theme')==='dark') document.body.classList.add('dark-mode');
        function switchPage(p) { document.getElementById('homePage').classList.add('hidden'); document.getElementById('profilePage').classList.add('hidden'); document.getElementById('allAppsPage').classList.add('hidden'); document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active-nav')); if(isAppOpen) document.getElementById('appViewContainer').style.display = p==='apps'?'flex':'none'; if(p==='home') { document.getElementById('homePage').classList.remove('hidden'); document.querySelectorAll('.nav-item')[0].classList.add('active-nav'); } else if(p==='apps') { document.getElementById('allAppsPage').classList.remove('hidden'); document.querySelectorAll('.nav-item')[1].classList.add('active-nav'); } else { document.getElementById('profilePage').classList.remove('hidden'); document.querySelectorAll('.nav-item')[2].classList.add('active-nav'); } }
    </script>
</body>
</html>